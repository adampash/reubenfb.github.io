<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Athlete Ages - Deadspin</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
    
<body>
    
<!--Div that holds input field, button, and text. All other elements generated in D3--> 
<div id="calculator">
    Enter your birthday:
    <form>
        <input type="date" name="inputbox" value="1980-01-01">
        <button type="button" onClick="record(this.form)">Submit</button>
    </form>  
    <p>You are older than:</p>
        <ul>
            <li><span id='nflpercent'>*</span> percent of NFL players</li>
            <li><span id='nbapercent'>*</span> percent of NBA players</li>
            <li><span id='mlbpercent'>*</span> percent of MLB players</li>
            <li><span id='nhlpercent'>*</span> percent of NHL players</li>
        </ul>     
</div>
    
<script type="text/javascript">

//data values for histograms
var nfldataset=            [{ age: 15, value: 0 },	
							{ age: 16, value: 0 },		
							{ age: 17, value: 0 },
							{ age: 18, value: 0 },
							{ age: 19, value: 0 },
							{ age: 20, value: 0 },
							{ age: 21, value: 0.003851091 },
							{ age: 22, value: 0.03465982 },
							{ age: 23, value: 0.110825845 },
							{ age: 24, value: 0.182284981 },
							{ age: 25, value: 0.150620454 },
							{ age: 26, value: 0.122807018 },
							{ age: 27, value: 0.094993582 },
							{ age: 28, value: 0.076593924 },
							{ age: 29, value: 0.062473256 },
							{ age: 30, value: 0.049636286 },
							{ age: 31, value: 0.03465982 },
							{ age: 32, value: 0.029097133 },
							{ age: 33, value: 0.018399658 },
							{ age: 34, value: 0.009413778 },
                            { age: 35, value: 0.007702182 },
                            { age: 36, value: 0.003423192 },
                            { age: 37, value: 0.003423192 },
                            { age: 38, value: 0.002567394 },
                            { age: 39, value: 0.001283697 },
                            { age: 40, value: 0.000427899 },
                            { age: 41, value: 0.000855798 },
                            { age: 42, value: 0 },
                            { age: 43, value: 0 },
                            { age: 44, value: 0 },
                            { age: 45, value: 0 }];
    
var nbadataset=            [{ age: 15, value: 0 },	
							{ age: 16, value: 0 },		
							{ age: 17, value: 0 },
							{ age: 18, value: 0 },
							{ age: 19, value: 0.0041841 },
							{ age: 20, value: 0.018828452 },
							{ age: 21, value: 0.050209205 },
							{ age: 22, value: 0.071129707 },
							{ age: 23, value: 0.10251046 },
							{ age: 24, value: 0.089958159 },
							{ age: 25, value: 0.119246862 },
							{ age: 26, value: 0.094142259 },
							{ age: 27, value: 0.073221757 },
							{ age: 28, value: 0.083682008 },
							{ age: 29, value: 0.062761506 },
							{ age: 30, value: 0.037656904 },
							{ age: 31, value: 0.048117155 },
							{ age: 32, value: 0.027196653 },
							{ age: 33, value: 0.031380753 },
							{ age: 34, value: 0.029288703 },
                            { age: 35, value: 0.018828452 },
                            { age: 36, value: 0.016736402 },
                            { age: 37, value: 0.008368201 },
                            { age: 38, value: 0.008368201 },
                            { age: 39, value: 0.00209205 },
                            { age: 40, value: 0.00209205 },
                            { age: 41, value: 0 },
                            { age: 42, value: 0 },
                            { age: 43, value: 0 },
                            { age: 44, value: 0 },
                            { age: 45, value: 0 }];
    
var mlbdataset=            [{ age: 15, value: 0 },	
							{ age: 16, value: 0 },		
							{ age: 17, value: 0 },
							{ age: 18, value: 0 },
							{ age: 19, value: 0 },
							{ age: 20, value: 0.001153403 },
							{ age: 21, value: 0.003460208 },
							{ age: 22, value: 0.020761246 },
							{ age: 23, value: 0.042675894 },
							{ age: 24, value: 0.073817762 },
							{ age: 25, value: 0.084198385 },
							{ age: 26, value: 0.101499423 },
							{ age: 27, value: 0.118800461 },
							{ age: 28, value: 0.101499423 },
							{ age: 29, value: 0.089965398 },
							{ age: 30, value: 0.084198385 },
							{ age: 31, value: 0.070357555 },
							{ age: 32, value: 0.047289504 },
							{ age: 33, value: 0.043829296 },
							{ age: 34, value: 0.025374856 },
                            { age: 35, value: 0.027681661 },
                            { age: 36, value: 0.019607843 },
                            { age: 37, value: 0.014994233 },
                            { age: 38, value: 0.01384083 },
                            { age: 39, value: 0.008073818 },
                            { age: 40, value: 0.003460208 },
                            { age: 41, value: 0.002306805 },
                            { age: 42, value: 0 },
                            { age: 43, value: 0 },
                            { age: 44, value: 0 },
                            { age: 45, value: 0 }];
    
var nhldataset=            [{ age: 15, value: 0 },	
							{ age: 16, value: 0 },		
							{ age: 17, value: 0 },
							{ age: 18, value: 0.00210084 },
							{ age: 19, value: 0.011554622 },
							{ age: 20, value: 0.026260504 },
							{ age: 21, value: 0.047268908 },
							{ age: 22, value: 0.071428571 },
							{ age: 23, value: 0.096638655 },
							{ age: 24, value: 0.089285714 },
							{ age: 25, value: 0.072478992 },
							{ age: 26, value: 0.077731092 },
							{ age: 27, value: 0.081932773 },
							{ age: 28, value: 0.06302521 },
							{ age: 29, value: 0.071428571 },
							{ age: 30, value: 0.070378151 },
							{ age: 31, value: 0.047268908 },
							{ age: 32, value: 0.040966387 },
							{ age: 33, value: 0.033613445 },
							{ age: 34, value: 0.022058824 },
                            { age: 35, value: 0.025210084 },
                            { age: 36, value: 0.013655462 },
                            { age: 37, value: 0.015756303 },
                            { age: 38, value: 0.006302521 },
                            { age: 39, value: 0.005252101 },
                            { age: 40, value: 0.00210084 },
                            { age: 41, value: 0.004201681 },
                            { age: 42, value: 0.00105042 },
                            { age: 43, value: 0.00105042 },
                            { age: 44, value: 0 },
                            { age: 45, value: 0 }];

//data values for individual player birthdays, imported from .csv 
var nfl = [];    
var nba = [];
var mlb = [];
var nhl = [];    
d3.csv("nfl.csv", function(data) {nfl = data;});
d3.csv("nba.csv", function(data) {nba = data;});
d3.csv("mlb.csv", function(data) {mlb = data;});
d3.csv("nhl.csv", function(data) {nhl = data;});   
    
//set scales and svg widths for D3
var w = 175;
var h = 175;
var padding = 7;
        
var xScale = d3.scale.linear()
        .domain([15,45])
        .range([padding*1.2,w-padding*1.2]);
        
var yScale = d3.scale.linear()
        .domain([0, 0.185])
        .range([0, h-padding-22]);
    
var xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom")
        .ticks(7)
        .tickSize(3);
    
//generate svgs for graphs
var nflsvg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h)
        .attr("id","nflsvg");
    
var nbasvg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h)
        .attr("id","nbasvg");
    
var mlbsvg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h)
        .attr("id","mlbsvg");
    
var nhlsvg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h)
        .attr("id","nhlsvg");

    
//generate rects, axes, labels, and titles for NFL    
    nflsvg.selectAll("rect")
        .data(nfldataset)
        .enter()
        .append("rect")
        .attr("x",function(d){return xScale(d.age);})
        .attr("y",function(d){return (h-padding)-22 - yScale(d.value);})
        .attr("width",(w)/nfldataset.length)
        .attr("height",function(d){return yScale(d.value);})
        .attr("fill","rgb(245,94,80)");
    
    nflsvg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (h-padding-22) + ")")
        .call(xAxis);
    nflsvg.append("text")
        .attr("x", 87 )
        .attr("y", 170)
        .style("text-anchor", "middle")
        .text("Age");
    nflsvg.append("text")
        .attr("x", 5 )
        .attr("y", 20)
        .attr("id","title")
        .style("text-anchor", "left")
        .text("NFL");
    
//generate rects, axes, labels, and titles for NBA   
    nbasvg.selectAll("rect")
        .data(nbadataset)
        .enter()
        .append("rect")
        .attr("x",function(d){return xScale(d.age);})
        .attr("y",function(d){return (h-padding)-22 - yScale(d.value);})
        .attr("width",(w)/nbadataset.length)
        .attr("height",function(d){return yScale(d.value);})
        .attr("fill","rgb(82,167,220)");
    
    nbasvg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (h-padding-22) + ")")
        .call(xAxis);
    nbasvg.append("text")
        .attr("x", 87 )
        .attr("y", 170)
        .style("text-anchor", "middle")
        .text("Age");
    nbasvg.append("text")
        .attr("x", 5 )
        .attr("y", 20)
        .attr("id","title")
        .style("text-anchor", "left")
        .text("NBA");
    
//generate rects, axes, labels, and titles for MLB   
    mlbsvg.selectAll("rect")
        .data(mlbdataset)
        .enter()
        .append("rect")
        .attr("x",function(d){return xScale(d.age);})
        .attr("y",function(d){return (h-padding)-22 - yScale(d.value);})
        .attr("width",(w)/mlbdataset.length)
        .attr("height",function(d){return yScale(d.value);})
        .attr("fill","rgb(96,185,101)");

    mlbsvg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (h-padding-22) + ")")
        .call(xAxis);
    mlbsvg.append("text")
        .attr("x", 87 )
        .attr("y", 170)
        .style("text-anchor", "middle")
        .text("Age");
    mlbsvg.append("text")
        .attr("x", 5 )
        .attr("y", 20)
        .attr("id","title")
        .style("text-anchor", "left")
        .text("MLB");
    
//generate rects, axes, labels, and titles for NHL  
    nhlsvg.selectAll("rect")
        .data(nhldataset)
        .enter()
        .append("rect")
        .attr("x",function(d){return xScale(d.age);})
        .attr("y",function(d){return (h-padding)-22 - yScale(d.value);})
        .attr("width",(w)/nhldataset.length)
        .attr("height",function(d){return yScale(d.value);})
        .attr("fill","rgb(178,123,179)");
    
    nhlsvg.append("g")
        .attr("class", "axis")
        .attr("transform", "translate(0," + (h-padding-22) + ")")
        .call(xAxis);
    nhlsvg.append("text")
        .attr("x", 87 )
        .attr("y", 170)
        .style("text-anchor", "middle")
        .text("Age")
    nhlsvg.append("text")
        .attr("x", 5 )
        .attr("y", 20)
        .attr("id","title")
        .style("text-anchor", "left")
        .text("NHL");

//percentage calculator which runs on form submission
    
var future = new Date("2050-01-01");
    
function record (form) {
    var nflpercent = 0;
    var nbapercent = 0;
    var mlbpercent = 0;
    var nhlpercent = 0;
    var birthdate = new Date(form.inputbox.value);
    var gap = (future - birthdate)/86400000;

//loops through birthday datasets, increments how many players are older than submitted birthdate
    for(var i = 0; i <nfl.length; i++){
    if(nfl[i].day<gap){nflpercent +=1;};
    nflprint = Math.round(((nflpercent/nfl.length)*100)*10)/10; };
        
    for(var i = 0; i <nba.length; i++){
    if(nba[i].day<gap){nbapercent +=1;};
    nbaprint = Math.round(((nbapercent/nba.length)*100)*10)/10;};
        
    for(var i = 0; i <mlb.length; i++){
    if(mlb[i].day<gap){mlbpercent +=1;};
    mlbprint = Math.round(((mlbpercent/mlb.length)*100)*10)/10;};
        
    for(var i = 0; i <nhl.length; i++){
    if(nhl[i].day<gap){nhlpercent +=1;};
    nhlprint = Math.round(((nhlpercent/nhl.length)*100)*10)/10;};

//maps calculated percentages to HTML
document.getElementById("nflpercent").innerHTML = "<strong>"+nflprint+"</strong>";
document.getElementById("nbapercent").innerHTML = "<strong>"+nbaprint+"</strong>";
document.getElementById("mlbpercent").innerHTML = "<strong>"+mlbprint+"</strong>";
document.getElementById("nhlpercent").innerHTML = "<strong>"+nhlprint+"</strong>";

//converts submitted birthdate to age, from http://jsfiddle.net/codovations/n33RJ/
var today = new Date();
var trueage = today.getFullYear() - birthdate.getFullYear();
var m = today.getMonth() - birthdate.getMonth();
if (m < 0 || (m === 0 && today.getDate() < birthdate.getDate())) {trueage--;};

//greys out portions of four histrograms based on submitted age
nflsvg.selectAll("rect")
        .transition()
        .duration(1000)
        .attr("fill",function(d){
        if(d.age>=trueage){return "rgb(195,195,195)"}
        else{return "rgb(245,94,80)"};
    });
    
nbasvg.selectAll("rect")
        .transition()
        .duration(1000)
        .attr("fill",function(d){
        if(d.age>=trueage){return "rgb(195,195,195)"}
        else{return "rgb(82,167,220)"};
    });

mlbsvg.selectAll("rect")
        .transition()
        .duration(1000)
        .attr("fill",function(d){
        if(d.age>=trueage){return "rgb(195,195,195)"}
        else{return "rgb(96,185,101)"};
    });
    
nhlsvg.selectAll("rect")
        .transition()
        .duration(1000)
        .attr("fill",function(d){
        if(d.age>=trueage){return "rgb(195,195,195)"}
        else{return "rgb(178,123,179)"};
    });
};
   
</script>
</body>
</html>